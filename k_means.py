import random
from typing import Callable
import math
import matplotlib.pyplot as plt


class Point:
    def __init__(self, x: float, y: float) -> None:
        self.x = x
        self.y = y

    @staticmethod
    def distance(p1: "Point", p2: "Point") -> float:
        return math.sqrt(math.pow((p1.x - p2.x), 2) + math.pow((p1.x - p2.x), 2))

    @staticmethod
    def avg(points: list["Point"]) -> "Point":
        x_avg = sum(p.x for p in points) / len(points)
        y_avg = sum(p.y for p in points) / len(points)

        return Point(x_avg, y_avg)

    @staticmethod
    def print_list(points: list["Point"]) -> str:
        return "\n".join([str(p) for p in points])

    def __repr__(self) -> str:
        return f"Point({self.x}, {self.y})"

    def __eq__(self, value: object) -> bool:
        if isinstance(value, self.__class__):
            return self.x == value.x and self.y == value.y

        raise NotImplementedError

    def __hash__(self) -> int:
        return id(self)


def k_means(
    k: int,
    points: list[Point],
    distance: Callable[[Point, Point], float],
    find_center: Callable[[list[Point]], Point],
) -> dict[Point, list[Point]]:
    centers = random.choices(points, k=k)

    is_steady = False

    rounds = 0

    while not is_steady:
        clusters: dict[Point, list] = {}

        for c in centers:
            clusters[c] = []

        for _, p in enumerate(points):
            # print(f"Point {_ + 1} / {len(points)}")
            min_distance, min_center = float("inf"), centers[0]

            for center in centers:
                calced_distance = distance(p, center)

                if calced_distance < min_distance:
                    min_distance = calced_distance
                    min_center = center

            clusters[min_center].append(p)

        new_centers = [find_center(clusters[c]) for c in clusters]

        for center in centers:
            if center in new_centers:
                is_steady = True
            else:
                is_steady = False

        centers = new_centers

        rounds += 1

    print(f"Finished in {rounds} rounds")

    return clusters


k = 5

points = [
    Point(7.413238356939068, 8.253947537523671),
    Point(9.653826589315835, 4.952144076267732),
    Point(4.014158865195726, 5.973886672768343),
    Point(2.0594081036844254, 7.797812912900312),
    Point(6.795062478716573, 5.677127953512318),
    Point(7.051631624145764, 4.69758601492357),
    Point(7.491093256401352, 1.102067681045646),
    Point(3.957589439738175, 4.631291487932273),
    Point(7.390471936989369, 7.982303271329967),
    Point(0.6801968616309464, 7.384219611624822),
    Point(7.018151730032233, 4.744754854489418),
    Point(3.8589453285200944, 9.374028086327017),
    Point(5.894571178167819, 0.29098938156851246),
    Point(8.172101241228818, 1.266092666331466),
    Point(7.780123315423345, 7.629729332164729),
    Point(7.53983151100033, 8.9507442097759),
    Point(4.972900356145648, 2.258476018674267),
    Point(1.6889377150678628, 5.829057201868005),
    Point(8.620999368138075, 7.204055867043675),
    Point(0.25765122479847425, 3.964490871239889),
    Point(4.542415963293101, 9.485329078466677),
    Point(4.216282578829473, 1.180930744035963),
    Point(8.924470195177206, 0.8891198869404529),
    Point(7.755862111304964, 2.0993670520658145),
    Point(4.105429312148183, 7.026862606779489),
    Point(2.752442260967974, 4.500202234880825),
    Point(1.753451383322437, 3.723981533213049),
    Point(9.053363217476284, 4.706184769315786),
    Point(5.442285834824625, 0.487994951515418),
    Point(8.04447061827192, 4.933034006417736),
    Point(2.4891525603433043, 9.115369104226585),
    Point(1.3612915863890177, 3.6784310143909094),
    Point(2.590923908992204, 7.256234299005865),
    Point(8.570119032377318, 9.607574168473712),
    Point(7.13715594717947, 1.3600509274066695),
    Point(7.616914344611565, 0.2987362722613481),
    Point(5.420887590384536, 2.480904434864611),
    Point(8.614198833294522, 2.505808317081194),
    Point(7.379586091234448, 4.222237413374653),
    Point(5.408960778470713, 9.898537622400274),
    Point(7.558018989780554, 8.13400754723474),
    Point(3.2067357171478196, 1.207768021368142),
    Point(2.089081553308662, 9.676225930485518),
    Point(5.316010982375436, 8.646689579848315),
    Point(3.112454692578151, 3.3052617753744954),
    Point(0.24810112538425845, 0.3727089939869827),
    Point(1.495951362727013, 4.466640041912107),
    Point(7.120347197439014, 7.563332103271494),
    Point(9.987736908635603, 4.420843203209934),
    Point(3.451962285232806, 1.5254728627347883),
    Point(4.176764802659331, 9.984162743006265),
    Point(7.509025206620002, 5.372331900972244),
    Point(8.297678871177425, 5.642250218762899),
    Point(3.8296030868014374, 0.31566015934844306),
    Point(1.2464975627380675, 4.373025901676916),
    Point(1.3721589354714025, 3.8544320716985815),
    Point(5.30078701204227, 9.362305674974098),
    Point(5.665891566996271, 4.045372601800152),
    Point(9.731741206822072, 3.0561556511586423),
    Point(0.5541904189435226, 4.154616202912916),
    Point(1.7806425794535117, 4.861660936034882),
    Point(8.207874643086136, 0.16694427557027477),
    Point(9.78991545289353, 9.915105757663493),
    Point(5.362256490550183, 1.014134437220491),
    Point(2.108560898159544, 2.3834810843861163),
    Point(4.785066744689261, 4.223334432812776),
    Point(9.183169165849776, 3.314132812223046),
    Point(9.498579316854616, 7.554228394808936),
    Point(5.520685369764399, 1.2111078573871603),
    Point(1.896316661634133, 4.796017606254662),
    Point(0.9643323933525331, 8.036366435401328),
    Point(7.780764531050032, 0.2618893491894412),
    Point(5.986303235207429, 2.3618494650688233),
    Point(5.897665738172862, 7.278303408454988),
    Point(9.893433898040937, 3.109377398141622),
    Point(2.6777254769268147, 6.162228818465176),
    Point(0.46747073538128994, 9.405442990050048),
    Point(9.211632654887597, 3.698759139660921),
    Point(9.251469029898504, 4.674034117947688),
    Point(1.0537596499569492, 8.719454174502674),
    Point(5.933863186434734, 7.108634535353303),
    Point(3.6764791697858365, 0.6407305399899882),
    Point(7.794028325808828, 1.5188587357912387),
    Point(3.4004256828398775, 9.974049924734632),
    Point(5.501320784446265, 9.411859446891947),
    Point(2.654903543203767, 4.066488349441716),
    Point(3.581636204640147, 2.046198922336028),
    Point(3.284267208284724, 2.554034693996856),
    Point(0.22872306989805176, 5.580443834826431),
    Point(2.330314214832504, 5.430692607977746),
    Point(1.4313204333549942, 5.198679389936599),
    Point(2.805820646138727, 2.3046782186710875),
    Point(7.892166303884576, 0.40114138233505824),
    Point(1.3806543703845124, 3.446432249099951),
    Point(2.654232530754356, 2.237126398344755),
    Point(7.246464607363906, 5.215378504488553),
    Point(4.842001611213462, 7.28054548448573),
    Point(2.9421656308536547, 2.079701558937079),
    Point(4.029939834244964, 1.8802668053569284),
    Point(5.661442045024298, 9.353740842456527),
    Point(9.619007987775453, 2.045384315671228),
    Point(7.370635987436736, 2.1628749969462717),
    Point(8.593373399265997, 9.474017932614592),
    Point(7.564497598664944, 0.6533093729297249),
    Point(2.2847595021786847, 7.416560756317073),
    Point(3.3244257597073464, 8.218618676785248),
    Point(3.3004420374077013, 7.263839067634234),
    Point(3.9056046494742063, 9.886327291301316),
    Point(3.255147935683156, 9.424573767612237),
    Point(2.2435900718801717, 1.785675303029552),
    Point(7.223225742649963, 4.123066805325453),
    Point(2.1578357683942265, 7.974631451330729),
    Point(7.648631929000784, 1.702369462018108),
    Point(4.431189042975797, 9.576745316676746),
    Point(0.953281670598192, 3.4161338586302117),
    Point(3.7444870140291246, 7.804892192874615),
    Point(7.274893292789203, 3.358442418682622),
    Point(7.619401732515647, 7.536487279335975),
    Point(2.657035400793682, 3.1881571373448285),
    Point(5.041028527877785, 1.8568546997397254),
    Point(9.445258303013856, 0.8425170490858627),
    Point(2.011192047988161, 2.019428720081135),
    Point(5.944923313774611, 4.725800614830048),
    Point(7.455574980651978, 0.8663351410478911),
    Point(1.877494183480414, 2.146429497517089),
    Point(7.620303094177111, 9.614232447892273),
    Point(8.788217372163454, 7.135928079725428),
    Point(2.749499215960699, 8.364028897163123),
    Point(5.567531583119656, 4.025164328650944),
    Point(5.907634481313832, 3.080839151424702),
    Point(6.448743803514999, 4.900583027713769),
    Point(3.579731074253039, 2.297108240591406),
    Point(2.488386189698072, 9.375300431933032),
    Point(6.930963698741157, 3.505787245207654),
    Point(5.173824948303464, 2.6344772364720454),
    Point(1.184354580312213, 9.271540494945444),
    Point(9.764918364173842, 2.2385420098449175),
    Point(3.9427552010803467, 5.488197133535981),
    Point(2.1276642034078895, 5.636339122406459),
    Point(4.682671069462299, 1.809501775674181),
    Point(3.666596214538115, 2.767720925836807),
    Point(1.1581209157270407, 9.10319247752525),
    Point(7.970233446963297, 3.393292012498042),
    Point(9.313209329508952, 7.26026796746084),
    Point(4.810094533181347, 0.10408836959869749),
    Point(8.47168565246597, 7.502113879444558),
    Point(1.2687851767030516, 1.2607203968788882),
    Point(1.7785801622713243, 7.070776160003513),
    Point(7.2135205296894, 1.0675860677811845),
    Point(4.707826159383266, 8.47032735382779),
    Point(3.377366856164173, 8.53586815361446),
    Point(1.194758767327434, 3.341964615914379),
    Point(6.689490306570819, 2.185031998169253),
    Point(4.986846423482503, 8.136495819223544),
    Point(4.188005422312871, 9.708468177917888),
    Point(5.026740230401505, 0.4446408959706144),
    Point(0.9086141437806765, 3.7168922779201843),
    Point(3.159409734515451, 5.108750632651876),
    Point(5.273942003026423, 3.6568691912243156),
    Point(0.5485635140457741, 6.576508947286515),
    Point(0.8581967138530275, 2.7682466245071875),
    Point(5.736688763670264, 0.7355866714657245),
    Point(4.944450197756047, 9.894401881495974),
    Point(9.754051084783814, 3.041848590186665),
    Point(9.203637392801622, 5.651022098295964),
    Point(1.6403167295581978, 4.622974732622582),
    Point(7.466236503408361, 7.438289314125802),
    Point(2.6124992016550386, 4.143845570619681),
]

clusters = k_means(k, points, Point.distance, Point.avg)  # {center: [p1, p2, ...], ...}
colors = ["b", "g", "c", "m", "y", "k"]

centers = list(clusters.keys())
color_per_center = {}

for c in centers:
    color = random.choice(colors)
    colors.remove(color)

    color_per_center[c] = color

xs = [p.x for p in centers]
ys = [p.y for p in centers]
color_per_point = ["r" for p in centers]

for c, l in clusters.items():
    for p in l:
        xs.append(p.x)
        ys.append(p.y)
        color_per_point.append(color_per_center[c])

plt.scatter(xs, ys, c=color_per_point)
plt.show()
